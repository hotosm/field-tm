{% extends "layout.html" %} {% block title %} {% if project %}{{
project.project_name }} - {% endif %}Field Tasking Manager {% endblock %} {%
block content %}
<div style="padding: 20px; max-width: 1200px; margin: 0 auto">
  <div style="margin-bottom: 20px">
    <wa-button href="/" variant="default" style="margin-bottom: 20px">
      ‚Üê Back to Projects
    </wa-button>
  </div>

  {% if project %}
  <wa-card>
    <div
      slot="header"
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <h1 style="margin: 0">{{ project.project_name or 'Unnamed Project' }}</h1>
      {% set status_value = project.status.value if project.status and
      project.status.value else (project.status if project.status is string else
      'DRAFT') %} {% set field_mapping_app_value = (
      project.field_mapping_app.value if project.field_mapping_app and
      (project.field_mapping_app is not string) and
      project.field_mapping_app.value else (project.field_mapping_app if
      project.field_mapping_app else none) ) %} {% set field_mapping_app_upper =
      field_mapping_app_value.upper() if field_mapping_app_value else none %} {%
      set has_xlsform = project.xlsform_content is not none and
      project.xlsform_content %} {% set has_data_extract =
      project.data_extract_geojson is not none and project.data_extract_geojson
      %} {% set is_empty_data_extract = project.data_extract_geojson == {} %} {%
      set has_task_areas = project.task_areas_geojson is not none %} {% set
      is_no_splitting = project.task_areas_geojson == {} %}
      <wa-badge
        variant="{% if status_value == 'DRAFT' %}neutral{% elif status_value == 'PUBLISHED' %}info{% elif status_value == 'COMPLETED' %}success{% else %}error{% endif %}"
      >
        {{ status_value }}
      </wa-badge>
    </div>

    <div style="padding: 20px">
      <!-- Description -->
      {% if project.description %}
      <div style="margin-bottom: 30px">
        <h3 style="color: #d63f3f; margin-bottom: 10px">Description</h3>
        <p style="color: #333; line-height: 1.6">{{ project.description }}</p>
      </div>
      {% endif %}

      <!-- Project Details Grid -->
      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
        "
      >
        <div>
          <h4
            style="
              color: #666;
              font-size: 0.9em;
              margin-bottom: 5px;
              font-weight: bold;
            "
          >
            Project ID
          </h4>
          <p style="color: #333; font-size: 1.1em">#{{ project.id }}</p>
        </div>

        {% if project.location_str %}
        <div>
          <h4
            style="
              color: #666;
              font-size: 0.9em;
              margin-bottom: 5px;
              font-weight: bold;
            "
          >
            Location
          </h4>
          <p style="color: #333; font-size: 1.1em">
            {{ project.location_str }}
          </p>
        </div>
        {% endif %} {% if field_mapping_app_value %}
        <div>
          <h4
            style="
              color: #666;
              font-size: 0.9em;
              margin-bottom: 5px;
              font-weight: bold;
            "
          >
            Field Mapping App
          </h4>
          <div style="display: flex; align-items: center; gap: 8px">
            {% set app_name = field_mapping_app_value %}
            <img
              src="/static/images/{{ app_name.lower() }}-logo.svg"
              alt="{{ app_name }}"
              style="width: 32px; height: 32px; object-fit: contain"
              onerror="this.style.display='none'"
            />
            <span style="color: #333; font-size: 1.1em">{{ app_name }}</span>
          </div>
        </div>
        {% endif %} {% if project.created_at %}
        <div>
          <h4
            style="
              color: #666;
              font-size: 0.9em;
              margin-bottom: 5px;
              font-weight: bold;
            "
          >
            Created
          </h4>
          <p style="color: #333; font-size: 1.1em">
            {{ project.created_at.strftime('%Y-%m-%d %H:%M') if
            project.created_at else 'N/A' }}
          </p>
        </div>
        {% endif %} {% if project.updated_at %}
        <div>
          <h4
            style="
              color: #666;
              font-size: 0.9em;
              margin-bottom: 5px;
              font-weight: bold;
            "
          >
            Last Updated
          </h4>
          <p style="color: #333; font-size: 1.1em">
            {{ project.updated_at.strftime('%Y-%m-%d %H:%M') if
            project.updated_at else 'N/A' }}
          </p>
        </div>
        {% endif %}
      </div>

      <!-- Hashtags -->
      {% if project.hashtags %}
      <div style="margin-bottom: 30px">
        <h4
          style="
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: bold;
          "
        >
          Hashtags
        </h4>
        <div style="display: flex; flex-wrap: wrap; gap: 8px">
          {% for tag in project.hashtags %}
          <wa-badge variant="neutral">{{ tag }}</wa-badge>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- External Project Info -->
      {% if project.external_project_instance_url %}
      <div
        style="
          margin-bottom: 30px;
          padding: 15px;
          background-color: #f5f5f5;
          border-radius: 4px;
        "
      >
        <h4
          style="
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: bold;
          "
        >
          External Project
        </h4>
        <p style="color: #333; font-size: 0.9em">
          <strong>Instance:</strong> {{ project.external_project_instance_url
          }}<br />
          {% if project.external_project_id %}
          <strong>Project ID:</strong> {{ project.external_project_id }} {%
          endif %}
        </p>
      </div>
      {% endif %} {% include "partials/project_details/setup_steps.html" %}
    </div>

    <div
      slot="footer"
      style="display: flex; gap: 10px; justify-content: flex-end"
    >
      <wa-button href="/" variant="default">Back to Projects</wa-button>
    </div>
  </wa-card>
  {% else %}
  <wa-card>
    <div style="padding: 40px; text-align: center">
      <h2 style="color: #d63f3f">Project Not Found</h2>
      <p style="color: #666; margin: 20px 0">
        The project you're looking for doesn't exist or you don't have
        permission to view it.
      </p>
      <wa-button href="/" variant="primary">Back to Projects</wa-button>
    </div>
  </wa-card>
  {% endif %}
</div>

{% include "partials/project_details/style_and_scripts.html" %} {% endblock %}
